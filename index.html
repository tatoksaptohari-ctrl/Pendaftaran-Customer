<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pendaftaran WiFi - Pilihan Grup</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { background-color: #f0f2f5; padding-bottom: 40px; }
        .card { border-radius: 15px; border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .header { background: #0056b3; color: white; padding: 20px; border-radius: 15px 15px 0 0; text-align: center; }
        #map { height: 250px; width: 100%; border-radius: 10px; border: 1px solid #ccc; }
        .btn-submit { background: #25d366; color: white; font-weight: bold; border-radius: 50px; padding: 12px; border: none; width: 100%; margin-top: 10px; }
        .btn-gps { background: #007bff; color: white; font-size: 11px; border-radius: 5px; border: none; padding: 4px 8px; }
        label { font-weight: 600; font-size: 0.9rem; color: #333; }
        .section-title { border-left: 4px solid #0056b3; padding-left: 10px; margin: 20px 0 10px 0; color: #0056b3; font-weight: bold; }
        .group-select { background: #e7f3ff; border: 1px solid #bde0ff; padding: 15px; border-radius: 10px; margin-top: 15px; }
    </style>
</head>
<body>

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="header"><h4>Form Pendaftaran Pelanggan</h4></div>
                <div class="card-body p-4">
                    <form id="regForm">
                        
                        <div class="section-title">DATA IDENTITAS</div>
                        <div class="mb-3">
                            <label class="form-label">Nama Lengkap</label>
                            <input type="text" id="nama" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">NIK KTP (16 Digit)</label>
                            <input type="number" id="ktp" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Alamat Sesuai KTP</label>
                            <textarea id="alamat_ktp" class="form-control" rows="2" placeholder="Tulis alamat lengkap sesuai identitas" required></textarea>
                        </div>

                        <div class="section-title">LOKASI PASANG</div>
                        <div class="mb-3">
                            <label class="form-label">No. WA Pelanggan</label>
                            <input type="tel" id="nowa" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Alamat Pemasangan WiFi</label>
                            <textarea id="alamat_pasang" class="form-control" rows="2" placeholder="Lokasi rumah yang akan dipasang" required></textarea>
                        </div>

                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <label class="text-primary mb-0">Tag Lokasi (Titik Pasang):</label>
                                <button type="button" class="btn-gps" onclick="getLocation()">üìç Ambil GPS</button>
                            </div>
                            <div id="map"></div>
                            <input type="hidden" id="lat"><input type="hidden" id="lng">
                        </div>

                        <div class="section-title">PERANGKAT & PAKET</div>
                        <div class="row">
                            <div class="col-6 mb-3"><label class="form-label">Merk Modem</label><input type="text" id="merk" class="form-control" required></div>
                            <div class="col-6 mb-3"><label class="form-label">SN Modem</label><input type="text" id="sn" class="form-control" required></div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Paket</label>
                            <select id="paket" class="form-select" required>
                                <option value="110">Paket 110</option>
                                <option value="135">Paket 135</option>
                                <option value="166">Paket 166</option>
                                <option value="222">Paket 222</option>
                            </select>
                        </div>

                        <div class="group-select">
                            <label class="d-block mb-2 text-primary">Pilih Tujuan Grup WA:</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="targetGrup" id="grup1" value="https://chat.whatsapp.com/LINK_GRUP_A" checked>
                                <label class="form-check-label" for="grup1">Grup Pendaftaran 1</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="targetGrup" id="grup2" value="https://chat.whatsapp.com/LINK_GRUP_B">
                                <label class="form-check-label" for="grup2">Grup Pendaftaran 2</label>
                            </div>
                        </div>
                        
                        <button type="submit" id="btnProses" class="btn-submit">SIMPAN DATA & BUKA GRUP</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // MASUKKAN URL GOOGLE SCRIPT ANDA DI SINI
    const URL_SHEETS = 'https://script.google.com/macros/s/AKfycbwVHxqE68G43FLPOzEr-FHu0O-GsN19oN_Oly18DXbVRtqiOLyZ8Iwx7r8J0-dqDkalBw/exec';

    var map = L.map('map').setView([-6.2000, 106.8000], 13);
    L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}').addTo(map);
    var marker = L.marker([-6.2000, 106.8000], {draggable: true}).addTo(map);

    function updateInputs(lat, lng) {
        document.getElementById('lat').value = lat;
        document.getElementById('lng').value = lng;
    }

    marker.on('dragend', function() {
        var pos = marker.getLatLng();
        updateInputs(pos.lat.toFixed(6), pos.lng.toFixed(6));
    });

    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                var lat = position.coords.latitude;
                var lng = position.coords.longitude;
                marker.setLatLng([lat, lng]);
                map.setView([lat, lng], 17);
                updateInputs(lat.toFixed(6), lng.toFixed(6));
            });
        }
    }

    document.getElementById('regForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const btn = document.getElementById('btnProses');
        const selectedGrup = document.querySelector('input[name="targetGrup"]:checked').value;
        
        btn.disabled = true;
        btn.innerText = "Menyimpan ke Excel...";

        const params = new URLSearchParams({
            nama: document.getElementById('nama').value,
            ktp: document.getElementById('ktp').value,
            alamat_ktp: document.getElementById('alamat_ktp').value,
            nowa: document.getElementById('nowa').value,
            alamat_pasang: document.getElementById('alamat_pasang').value,
            merk: document.getElementById('merk').value,
            sn: document.getElementById('sn').value,
            paket: document.getElementById('paket').value,
            lokasi: `http://maps.google.com/?q=${document.getElementById('lat').value},${document.getElementById('lng').value}`
        });

        fetch(URL_SHEETS, { method: 'POST', mode: 'no-cors', body: params })
        .then(() => {
            alert("Berhasil! Data tersimpan di Google Sheets. Anda akan diarahkan ke Grup pilihan.");
            window.open(selectedGrup, '_blank');
            btn.disabled = false;
            btn.innerText = "SIMPAN DATA & BUKA GRUP";
        })
        .catch(() => {
            alert("Terjadi kesalahan koneksi.");
            btn.disabled = false;
        });
    });
</script>
</body>
</html>
